<h1 class="page-title">
    <span class="icon">ğŸ“˜</span>
    Boletim
</h1>

<div class="card">
    <div class="form-grid">
        <div class="field">
            <label for="turma">Turma</label>
            <select id="turma" (change)="onTurmaChange($event)">
                <option value="">Selecione uma turma</option>
                <option *ngFor="let turma of turmas" [value]="turma.id">
                    {{ turma.nome }}
                </option>
            </select>
        </div>

        <div class="field">
            <label for="disciplina">Disciplina</label>
            <select id="disciplina" (change)="onDisciplinaChange($event)">
                <option value="">Selecione uma disciplina</option>
                <option *ngFor="let disciplina of disciplinas" [value]="disciplina.id">
                    {{ disciplina.nome }}
                </option>
            </select>
        </div>

        <div class="field actions">
            <button (click)="carregarBoletim()" [disabled]="!turmaSelecionadaId || !disciplinaSelecionadaId">
                ğŸ“Š Carregar Boletim
            </button>
        </div>
    </div>
</div>

<div class="table-actions" *ngIf="boletimAgrupado.length > 0">
    <button *ngIf="!modoEdicao" (click)="ativarEdicao()">
        âœï¸ Editar
    </button>

    <button (click)="mostrarFormularioNovaAvaliacao = !mostrarFormularioNovaAvaliacao">
        âœš Adicionar AvaliaÃ§Ã£o
    </button>

    <button *ngIf="modoEdicao" (click)="salvarBoletim()">
        ğŸ’¾ Salvar
    </button>

    <button *ngIf="modoEdicao" class="secondary" (click)="cancelarEdicao()">
        âŒ Cancelar
    </button>
</div>

<div *ngIf="mostrarFormularioNovaAvaliacao" class="form-nova-avaliacao">
    <input type="text" placeholder="Nome da AvaliaÃ§Ã£o" [(ngModel)]="novaAvaliacaoNome" />
    <input type="number" placeholder="Peso (1-5)" [(ngModel)]="novaAvaliacaoPeso" min="1" max="5" />
    <button (click)="criarAvaliacao(novaAvaliacaoNome, novaAvaliacaoPeso)">
        ğŸ’¾ Criar
    </button>
</div>


<div class="table-card" *ngIf="boletimAgrupado.length > 0">
    <table>
        <thead>
            <tr>
                <th>Aluno</th>

                <th *ngFor="let av of boletimAgrupado[0].avaliacoes">
                    {{ av.titulo }}
                    <span class="peso">(Peso {{ av.peso }})</span>
                </th>

                <th>MÃ©dia</th>
            </tr>
        </thead>

        <tbody>
            <tr *ngFor="let aluno of boletimAgrupado">
                <td class="aluno">
                    ğŸ‘¤ {{ aluno.alunoNome }}
                </td>

                <td *ngFor="let av of aluno.avaliacoes" class="nota">
                    <span *ngIf="!modoEdicao">
                        {{ av.nota ?? '-' }}
                    </span>

                    <input *ngIf="modoEdicao" type="number" min="0" max="10" step="0.1" [(ngModel)]="av.nota"
                        (input)="recalcularMedia(aluno)" />
                </td>

                <td class="media">
                    {{ aluno.mediaPonderada ?? '-' }}
                </td>
            </tr>
        </tbody>
    </table>
</div>